echo "🚀 Running pre-push checks..."

# 브랜치 정보 확인
protected_branch="main"
current_branch=$(git branch --show-current)

echo "📍 Current branch: $current_branch"

# main 브랜치로 push할 때는 전체 테스트 실행
if [ "$current_branch" = "$protected_branch" ]; then
  echo "⚠️  Pushing to protected branch '$protected_branch' - running full test suite..."
  
  echo "🧪 Running unit tests..."
  if ! pnpm test:unit; then
    echo "❌ Unit tests failed. Push aborted."
    exit 1
  fi

  echo "🔨 Building project..."
  if ! pnpm build --logLevel silent; then
    echo "❌ Build failed. Push aborted."
    exit 1
  fi

  echo "🎭 Running E2E tests..."
  if ! pnpm test:e2e; then
    echo "❌ E2E tests failed. Push aborted."
    exit 1
  fi

  echo "✅ All tests passed for $protected_branch branch!"
else
  # 다른 브랜치는 빠른 체크만
  echo "🔍 Running quick checks for feature branch..."
  
  echo "🧪 Running unit tests..."
  if ! pnpm test:unit; then
    echo "❌ Unit tests failed. Push aborted."
    exit 1
  fi

  echo "🔨 Building project..."
  if ! pnpm build --logLevel silent; then
    echo "❌ Build failed. Push aborted."
    exit 1
  fi

  echo "✅ Quick checks passed for branch '$current_branch'!"
fi

echo "🎉 Pre-push validation complete. Proceeding with push..."