echo "📝 Validating commit message..."

# 커밋 메시지 파일 읽기
commit_message=$(cat "$1")

# 기본 규칙 체크
if [ ${#commit_message} -lt 10 ]; then
  echo "❌ Commit message too short (minimum 10 characters)"
  echo "Current: '$commit_message' (${#commit_message} chars)"
  exit 1
fi

if [ ${#commit_message} -gt 100 ]; then
  echo "❌ Commit message too long (maximum 100 characters)"
  echo "Current: ${#commit_message} chars"
  exit 1
fi

# 특수 메시지 허용 (merge, revert 등)
if echo "$commit_message" | grep -qE "^(Merge|Revert|fixup!|squash!|📝 Update frontmatter)"; then
  echo "✅ Special commit message accepted"
  exit 0
fi

# 이모지로 시작하는지 확인 (선택적)
if echo "$commit_message" | grep -qE "^[🎨🐛✨🚀📝💚👷💄🔧🔨🌐💡🔀🗃️⚡💥🏗️📦🚚📄🔊🙈⚗️🍱♿💫🗑️🔐📈🐳🔀💫]"; then
  echo "✅ Commit message validation passed"
  exit 0
fi

# 일반적인 동사로 시작하는지 확인
if echo "$commit_message" | grep -qiE "^(add|fix|update|remove|refactor|docs|style|test|chore|feat|build|ci|perf):?\s"; then
  echo "✅ Conventional commit format detected"
  exit 0
fi

echo "⚠️  Consider using emoji or conventional commit format"
echo "Examples:"
echo "  ✨ Add new feature"
echo "  🐛 Fix bug in login"
echo "  📝 Update documentation" 
echo "  feat: add user authentication"
echo ""
echo "✅ Commit message accepted (basic validation passed)"